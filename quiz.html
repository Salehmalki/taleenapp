<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>اختبار نسب النبي ﷺ</title>
  <link rel="stylesheet" href="assets/css/enhanced-style.css">
  <link rel="stylesheet" href="assets/css/compatibility.css">
  <script src="assets/js/audio.js" defer></script>
  <script src="assets/js/ios-compatibility.js" defer></script>
</head>
<body>
  <header>
    <h1>اختبر معلوماتك في نسب النبي ﷺ</h1>
  </header>

  <main class="quiz-container">
    <div id="quizBox">
      <div id="question" class="question-box"></div>
      <div id="answers" class="answers-box"></div>
      <div id="timer">الوقت: <span id="time">120</span> ثانية</div>
    </div>
    <div id="result"></div>
  </main>

  <footer>
    <p>عمل الطالبة: تالين المالكي | إشراف: المعلمة منيرة الدوسري</p>
  </footer>

  <script>
    const questions = [
      {
        q: "ما اسم والدة النبي ﷺ؟",
        a: ["صفية بنت عبد المطلب", "أم سلمة", "آمنة بنت وهب", "زينب بنت جحش"],
        correct: 2
      },
      {
        q: "من هو جد النبي ﷺ من جهة أبيه؟",
        a: ["عبد مناف", "هاشم", "عبد المطلب", "قصي"],
        correct: 2
      },
      {
        q: "من هو والد النبي محمد ﷺ؟",
        a: ["أبو طالب", "حمزة بن عبد المطلب", "عبد الله بن عبد المطلب", "العباس بن عبد المطلب"],
        correct: 2
      },
      {
        q: "من هو جد النبي ﷺ من جهة أمه؟",
        a: ["عبد الله بن وهب", "عبد مناف بن زهرة", "وهب بن عبد مناف", "زهرة بن كلاب"],
        correct: 2
      },
      {
        q: "في أي جد يلتقي النسب؟",
        a: ["عبد مناف بن قصي", "هاشم بن عبد مناف", "كلاب بن مرة", "قصي بن كلاب"],
        correct: 2
      },
      {
        q: "إلى أي بطن تنتمي والدة النبي ﷺ؟",
        a: ["بنو هاشم", "بنو أمية", "بنو زهرة", "بنو مخزوم"],
        correct: 2
      },
      {
        q: "من هو الجد الذي جمع قريشًا في مكة؟",
        a: ["عبد المطلب", "هاشم", "قصي", "عبد مناف"],
        correct: 2
      }
    ];

    let current = 0;
    let score = 0;
    let timeLeft = 120;
    let timer;

    window.onload = () => {
      // ترتيب الأسئلة عشوائيًا
      questions.sort(() => Math.random() - 0.5);
      showQuestion();
      startTimer();
    };

    function startTimer() {
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById("time").textContent = timeLeft;
        if (timeLeft <= 0) endQuiz();
      }, 1000);
    }

    function showQuestion() {
      const q = questions[current];
      document.getElementById("question").textContent = q.q;
      const answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = "";
      
      // ترتيب الإجابات عشوائيًا مع الاحتفاظ بالإجابة الصحيحة
      const correctAnswer = q.a[q.correct];
      const shuffledAnswers = [...q.a].sort(() => Math.random() - 0.5);
      const newCorrectIndex = shuffledAnswers.indexOf(correctAnswer);
      
      shuffledAnswers.forEach((ans, index) => {
        const btn = document.createElement("button");
        btn.textContent = ans;
        btn.onclick = () => checkAnswer(index, newCorrectIndex);
        answersDiv.appendChild(btn);
      });
    }

    function checkAnswer(selected, correctIndex) {
      const buttons = document.querySelectorAll("#answers button");
      
      if (selected === correctIndex) {
        // الإجابة صحيحة
        buttons[selected].classList.add("correct");
        playCorrectSound();
        score++;
      } else {
        // الإجابة خاطئة
        buttons[selected].classList.add("incorrect");
        buttons[correctIndex].classList.add("correct");
        playIncorrectSound();
      }
      
      // تعطيل جميع الأزرار بعد الإجابة
      buttons.forEach(btn => {
        btn.disabled = true;
      });
      
      // الانتقال إلى السؤال التالي بعد فترة قصيرة
      setTimeout(() => {
        current++;
        if (current < questions.length) {
          showQuestion();
        } else {
          endQuiz();
        }
      }, 1500);
    }

    function endQuiz() {
      clearInterval(timer);
      document.getElementById("quizBox").style.display = "none";
      const result = document.getElementById("result");
      result.style.display = "block";
      
      let message = "";
      if (score === questions.length) {
        message = "<h2>ممتاز! 🎉</h2><p>لقد أجبت على جميع الأسئلة بشكل صحيح!</p>";
        message += '<p><a href="certificate.html" class="result-button certificate">عرض الشهادة 🏆</a></p>';
      } else if (score >= questions.length * 0.7) {
        message = `<h2>أحسنت! 👏</h2><p>لقد أجبت على ${score} من ${questions.length} أسئلة بشكل صحيح.</p>`;
      } else if (score >= questions.length * 0.5) {
        message = `<h2>جيد! 👍</h2><p>لقد أجبت على ${score} من ${questions.length} أسئلة بشكل صحيح.</p>`;
      } else {
        message = `<h2>حاول مرة أخرى! 💪</h2><p>لقد أجبت على ${score} من ${questions.length} أسئلة بشكل صحيح.</p>`;
      }
      
      message += '<div class="result-buttons">' +
        '<a href="quiz.html" class="result-button retry">🔁 إعادة الاختبار</a>' +
        '<a href="index.html" class="result-button home">🏠 الصفحة الرئيسية</a>' +
        '</div>';
      
      result.innerHTML = message;
    }
  </script>
</body>
</html>
