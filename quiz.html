<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>اختبار نسب النبي محمد ﷺ</title>
  <link rel="stylesheet" href="assets/css/enhanced-style.css">
  <link rel="stylesheet" href="assets/css/enhanced-safari-fix.css">
  <link rel="stylesheet" href="assets/css/ui-consistency-fix.css">
  <link rel="stylesheet" href="assets/css/mobile-compatibility.css">
  <link rel="stylesheet" href="assets/css/countdown-timer.css">
  <script src="assets/js/simplified-audio.js" defer></script>
  <script src="assets/js/enhanced-safari-compatibility.js" defer></script>
  <script src="assets/js/mobile-compatibility.js" defer></script>
  <script src="assets/js/updated-quiz-questions.js" defer></script>
</head>
<body>
  <header>
    <h1>اختبار نسب النبي محمد ﷺ</h1>
    <p class="subtitle">اختبري معلوماتك عن نسب النبي محمد ﷺ</p>
  </header>

  <main>
    <div class="quiz-container">
      <div class="timer-container">
        <div class="timer-progress">
          <div id="timer-bar"></div>
        </div>
        <div id="timer-text">30</div>
      </div>
      
      <div id="question-container">
        <h2 id="question-text">جاري تحميل الأسئلة...</h2>
        <div class="answers-box" id="answers-box">
          <!-- سيتم إنشاء الإجابات ديناميكيًا باستخدام JavaScript -->
        </div>
      </div>
      
      <div id="result-container" style="display: none;">
        <h2>نتيجة الاختبار</h2>
        <p id="result-text"></p>
        <div class="result-buttons">
          <button id="retry-button" class="result-button retry clickable">إعادة الاختبار</button>
          <a href="index.html" class="result-button home clickable">العودة للصفحة الرئيسية</a>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>عمل الطالبة: تالين المالكي | إشراف: المعلمة منيرة الدوسري</p>
  </footer>

  <!-- تم إزالة شريط التنقل الثابت بناءً على طلب المستخدم -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // متغيرات الاختبار
      let currentQuestion = 0;
      let score = 0;
      let timer;
      let timeLeft = 30;
      let questions = [];
      
      // تهيئة الاختبار
      function initQuiz() {
        // استخدام الأسئلة المحدثة
        questions = quizQuestions.slice();
        
        // ترتيب الأسئلة عشوائيًا
        shuffleArray(questions);
        
        // عرض السؤال الأول
        showQuestion();
        
        // بدء العداد التنازلي
        startTimer();
      }
      
      // دالة عرض السؤال
      function showQuestion() {
        const questionData = questions[currentQuestion];
        const questionText = document.getElementById('question-text');
        const answersBox = document.getElementById('answers-box');
        
        // عرض نص السؤال
        questionText.textContent = questionData.q;
        
        // إنشاء أزرار الإجابات
        answersBox.innerHTML = '';
        
        // نسخ مصفوفة الإجابات وترتيبها عشوائيًا
        const answers = questionData.a.slice();
        shuffleArray(answers);
        
        // إنشاء أزرار الإجابات
        answers.forEach(function(answer, index) {
          const button = document.createElement('button');
          button.className = 'clickable';
          button.textContent = answer;
          button.addEventListener('click', function() {
            // التحقق من الإجابة
            checkAnswer(answer, questionData);
          });
          answersBox.appendChild(button);
        });
        
        // إعادة ضبط العداد التنازلي
        resetTimer();
      }
      
      // دالة التحقق من الإجابة
      function checkAnswer(selectedAnswer, questionData) {
        const correctAnswer = questionData.a[questionData.correct];
        
        if (selectedAnswer === correctAnswer) {
          // الإجابة صحيحة
          score++;
          
          // تشغيل صوت النقرة
          if (typeof playClickSound === 'function') {
            playClickSound();
          }
        } else {
          // الإجابة خاطئة
          // تشغيل صوت النقرة
          if (typeof playClickSound === 'function') {
            playClickSound();
          }
        }
        
        // الانتقال إلى السؤال التالي أو إنهاء الاختبار
        currentQuestion++;
        
        if (currentQuestion < questions.length) {
          showQuestion();
        } else {
          endQuiz();
        }
      }
      
      // دالة إنهاء الاختبار
      function endQuiz() {
        // إيقاف العداد التنازلي
        clearInterval(timer);
        
        // إخفاء حاوية الأسئلة وإظهار حاوية النتيجة
        document.getElementById('question-container').style.display = 'none';
        document.getElementById('result-container').style.display = 'block';
        
        // عرض النتيجة
        const resultText = document.getElementById('result-text');
        const percentage = Math.round((score / questions.length) * 100);
        
        resultText.textContent = `لقد حصلت على ${score} من ${questions.length} (${percentage}%)`;
        
        // إذا كانت النتيجة كاملة، عرض رابط الشهادة
        if (score === questions.length) {
          const resultButtons = document.querySelector('.result-buttons');
          
          // إنشاء زر الشهادة إذا لم يكن موجودًا
          if (!document.getElementById('certificate-button')) {
            const certificateButton = document.createElement('a');
            certificateButton.id = 'certificate-button';
            certificateButton.href = 'certificate.html';
            certificateButton.className = 'result-button certificate clickable';
            certificateButton.textContent = 'عرض الشهادة';
            resultButtons.appendChild(certificateButton);
          }
        }
        
        // إضافة مستمع لزر إعادة الاختبار
        document.getElementById('retry-button').addEventListener('click', function() {
          // إعادة تهيئة الاختبار
          currentQuestion = 0;
          score = 0;
          
          // إخفاء حاوية النتيجة وإظهار حاوية الأسئلة
          document.getElementById('result-container').style.display = 'none';
          document.getElementById('question-container').style.display = 'block';
          
          // إعادة تشغيل الاختبار
          initQuiz();
        });
      }
      
      // دالة بدء العداد التنازلي
      function startTimer() {
        const timerBar = document.getElementById('timer-bar');
        const timerText = document.getElementById('timer-text');
        const timerContainer = document.querySelector('.timer-container');
        
        // إعادة ضبط العداد التنازلي
        timeLeft = 30;
        timerText.textContent = timeLeft;
        timerBar.style.width = '100%';
        timerContainer.classList.remove('timer-warning', 'timer-danger');
        
        // بدء العداد التنازلي
        timer = setInterval(function() {
          timeLeft--;
          timerText.textContent = timeLeft;
          timerBar.style.width = (timeLeft / 30 * 100) + '%';
          
          // تغيير لون العداد عندما يقترب الوقت من النهاية
          if (timeLeft <= 10 && timeLeft > 5) {
            timerContainer.classList.add('timer-warning');
            timerContainer.classList.remove('timer-danger');
          } else if (timeLeft <= 5) {
            timerContainer.classList.remove('timer-warning');
            timerContainer.classList.add('timer-danger');
          }
          
          // إذا انتهى الوقت، الانتقال إلى السؤال التالي
          if (timeLeft <= 0) {
            clearInterval(timer);
            
            // الانتقال إلى السؤال التالي أو إنهاء الاختبار
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
              showQuestion();
            } else {
              endQuiz();
            }
          }
        }, 1000);
      }
      
      // دالة إعادة ضبط العداد التنازلي
      function resetTimer() {
        clearInterval(timer);
        startTimer();
      }
      
      // دالة ترتيب المصفوفة عشوائيًا
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }
      
      // بدء الاختبار
      initQuiz();
    });
  </script>
</body>
</html>
